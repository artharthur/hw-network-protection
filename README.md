# –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ: ¬´–ó–∞—â–∏—Ç–∞ —Å–µ—Ç–∏¬ª

## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é –∑–∞–¥–∞–Ω–∏–π

### –°–µ—Ç–∏
- Ubuntu (–∂–µ—Ä—Ç–≤–∞): 10.211.55.19  
- Kali (–∞—Ç–∞–∫—É—é—â–∏–π): 10.211.55.21  
–û–±–µ –º–∞—à–∏–Ω—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –æ–¥–Ω–æ–π –ø–æ–¥—Å–µ—Ç–∏ `10.211.55.0/24`.

### –°–∫—Ä–∏–Ω—à–æ—Ç—ã
1. IP-–∞–¥—Ä–µ—Å–∞ –æ–±–µ–∏—Ö –º–∞—à–∏–Ω (`ip a`):  
![](screenshot/net_ip_ubuntu.png)  
![](screenshot/net_ip_kali.png)

2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–∏ (ping):  
![](screenshot/ping_from_kali.png)  
![](screenshot/ping_from_ubuntu.png)

3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–π Suricata –∏ Fail2Ban (Ubuntu):  
![](screenshot/ubuntu_suricata.png)  
![](screenshot/ubuntu_fail2ban.png)

4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –Ω–∞ Kali (nmap, hydra):  
![](screenshot/kali_nmap.png)  
![](screenshot/kali_hydra.png)


## –ó–∞–¥–∞–Ω–∏–µ 1

–†–∞–∑–≤–µ–¥–∫–∞ `nmap` —Å Kali –ø–æ —Ü–µ–ª–µ–≤–æ–º—É —Ö–æ—Å—Ç—É (Ubuntu):

- `sudo nmap -sA 10.211.55.19`
- `sudo nmap -sT 10.211.55.19`
- `sudo nmap -sS 10.211.55.19`
- `sudo nmap -sV 10.211.55.19`

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
–û—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ—Ä—Ç—ã –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã nmap:
- **80/tcp** ‚Äî HTTP (HAProxy 2.0.0+)
- **3306/tcp** ‚Äî MySQL 8.0.x

–°–∫—Ä–∏–Ω:  
![](screenshot/hw_1_nmap.png)

### –°–æ–±—ã—Ç–∏—è –≤ Suricata
Suricata –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–ª–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:
- `ET SCAN Possible Nmap User-Agent Observed`
- `SURICATA AppLayer Mismatch protocol both directions`

–°–∫—Ä–∏–Ω:  
![](screenshot/hw_1_suricata.png)

### Fail2Ban
Jail `sshd` –∞–∫—Ç–∏–≤–µ–Ω, –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –Ω–µ—Ç (—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ nmap –±–∞–Ω–æ–≤ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç).

–î–∞, –∫–æ–Ω–µ—á–Ω–æ üëç
–Ø –¥–æ–±–∞–≤–ª—é —Ç–∞–∫–∏–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –ø—Ä—è–º–æ –≤ —Ç–µ–∫—Å—Ç –ó–∞–¥–∞–Ω–∏—è 2, –∫–∞–∫ —ç—Ç–æ —Å–¥–µ–ª–∞–Ω–æ —É —Ç–µ–±—è –≤ –ó–∞–¥–∞–Ω–∏–∏ 1. –í–æ—Ç –∏—Ç–æ–≥–æ–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç:

## –ó–∞–¥–∞–Ω–∏–µ 2

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Fail2Ban

–§–∞–π–ª `/etc/fail2ban/jail.conf`, —Å–µ–∫—Ü–∏—è `[sshd]` –±—ã–ª–∞ –∏–∑–º–µ–Ω–µ–Ω–∞ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –∑–∞—â–∏—Ç—ã SSH:

```ini
[sshd]
enabled  = true
port     = ssh
filter   = sshd
logpath  = %(sshd_log)s
backend  = %(sshd_backend)s
maxretry = 3
```

–°–∫—Ä–∏–Ω—à–æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥–∞ Fail2Ban:
![](screenshot/hw_2_fail2ban_config.png)

–ê—Ç–∞–∫–∞ –Ω–∞ –ø–æ–¥–±–æ—Ä –ø–∞—Ä–æ–ª—è (hydra)

–°–æ–∑–¥–∞–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
	‚Ä¢	users.txt ‚Äî —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
	‚Ä¢	pass.txt ‚Äî —Å–ø–∏—Å–æ–∫ –ø–∞—Ä–æ–ª–µ–π

–ó–∞–ø—É—Å–∫ –∞—Ç–∞–∫–∏:
```
hydra -L users.txt -P pass.txt 10.211.55.19 ssh
```
–†–µ–∑—É–ª—å—Ç–∞—Ç: —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –ø–æ—Ä—Ç—É 22 –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ (Connection refused), —Ç–∞–∫ –∫–∞–∫ —Å–ª—É–∂–±–∞ SSH –Ω–∞ —Ü–µ–ª–µ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ –æ—Ç–∫–ª—é—á–µ–Ω–∞.

–°–∫—Ä–∏–Ω—à–æ—Ç –∞—Ç–∞–∫–∏ hydra:
![](screenshot/hw_2_hydra.png)

–°–æ–±—ã—Ç–∏—è –≤ Fail2Ban

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ jail –∏ –ª–æ–≥–æ–≤ –≤—ã–ø–æ–ª–Ω—è–ª–∞—Å—å –∫–æ–º–∞–Ω–¥–∞–º–∏:

sudo fail2ban-client status sshd
sudo tail -n 30 /var/log/fail2ban.log

–†–µ–∑—É–ª—å—Ç–∞—Ç: Jail sshd –∞–∫—Ç–∏–≤–µ–Ω, –Ω–æ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –Ω–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ.

–°–∫—Ä–∏–Ω—à–æ—Ç —Å—Ç–∞—Ç—É—Å–∞ –∏ –ª–æ–≥–æ–≤ Fail2Ban:
![](screenshot/hw_2_fail2ban_status_log.png)

–°–æ–±—ã—Ç–∏—è –≤ Suricata

–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ Suricata:
```
sudo grep -i ssh /var/log/suricata/fast.log | tail -n 20
sudo grep -i ssh /var/log/suricata/eve.json | tail
```
